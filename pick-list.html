<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“¦ åŸ·è²¨æ¸…å–®</title>
<style>
  :root { --primary: #2563eb; --hk-color: #1e40af; --tw-color: #7c3aed; }
  body { font-family: -apple-system, sans-serif; background: #f8fafc; margin: 0; padding: 15px; }
  .header { text-align: center; margin-bottom: 20px; position: relative; }
  .back-btn { position: absolute; left: 0; top: 5px; background: none; border: none; font-size: 16px; color: var(--primary); cursor: pointer; }
  
  .region-section { background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 5px solid; }
  .hk-section { border-top-color: var(--hk-color); }
  .tw-section { border-top-color: var(--tw-color); }
  
  .region-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
  .total-weight { font-size: 13px; background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 20px; }

  /* å¤§ç´…æ¡†å¤–å±¤ä½ˆå±€ */
  .cust-card { 
    display: flex; 
    align-items: center; 
    border: 2.5px solid #ef4444; 
    border-radius: 12px; 
    margin-bottom: 20px; 
    background: #fff;
    overflow: hidden;
  }

  /* å·¦å´æœ€å°ç·¨è™Ÿå¤§æ¡† */
  .min-code-side {
    background: #ef4444;
    color: #fff;
    font-size: 32px;
    font-weight: 900;
    width: 60px;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    align-self: stretch; /* ç¢ºä¿é«˜åº¦æ’æ»¿ */
    border-right: 2.5px solid #ef4444;
  }

  /* å³å´è³‡è¨Šå€ */
  .cust-info-side {
    flex: 1;
    padding: 12px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center; /* ç½®ä¸­è³‡è¨Š */
    text-align: center;
  }

  .cust-name { 
    font-weight: bold; 
    font-size: 18px; 
    color: #1e293b; 
    margin-bottom: 8px;
  }
  
  /* ç´°é»ƒæ¡†å®¹å™¨ */
  .code-container { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 8px; 
    justify-content: center; 
  }

  /* ç´°é»ƒæ¡†æ¨£å¼ */
  .code-box { 
    border: 1.5px solid #f59e0b; 
    background: #fffbeb; 
    color: #92400e; 
    padding: 4px 10px; 
    border-radius: 6px; 
    font-weight: bold; 
    font-size: 16px; 
  }

  .loading { text-align: center; padding: 50px; color: #64748b; }
</style>
</head>
<body>

<div id="content">è¼‰å…¥ä¸­...</div>

<script>
const API = 'https://script.google.com/macros/s/AKfycby2I6Q2M67npEFW-Vqi14JS3L7rtuQ9DLD35KwhwCaGpyt3xBnRfNyeLcOGXfslA9sx/exec'; // é€™è£¡å¡«å…¥ä½ çš„ GAS ç¶²å€
const password = '4916';

function loadData() {
  fetch(API, {
    method: 'POST',
    body: new URLSearchParams({ action: 'getPickListData', password: password })
  })
  .then(r => r.json())
  .then(data => {
    if (!data.allGroups) return;
    render(data);
  });
}

function render(data) {
  const container = document.getElementById('mainContent');
  container.innerHTML = '';
  
  const groupName = data.latestGroup;
  document.getElementById('pageTitle').innerText = `ğŸ“¦ ${groupName} åŸ·è²¨æ¸…å–®`;
  
  const groups = data.allGroups[groupName];
  if (!groups) {
    container.innerHTML = `<div class="loading">æ‰¾ä¸åˆ° ${groupName} çš„è¨‚å–®è³‡æ–™</div>`;
    return;
  }

  ['HK', 'TW'].forEach(regionKey => {
    const info = groups[regionKey];
    if (Object.keys(info.customers).length === 0) return;

    const label = regionKey === 'HK' ? 'ğŸ‡­ğŸ‡° é¦™æ¸¯åœ˜' : 'ğŸ‡¹ğŸ‡¼ å°ç£åœ˜';
    const cssClass = regionKey === 'HK' ? 'hk-section' : 'tw-section';

    let html = `
      <div class="region-section ${cssClass}">
        <div class="region-title">
          ${label}
          <span class="total-weight">ç¸½é‡: ${info.totalWeight.toFixed(3)} kg</span>
        </div>
    `;

    // æ’åºå®¢äºº
    const sortedCustIds = Object.keys(info.customers).sort();

    sortedCustIds.forEach(custId => {
      const codes = info.customers[custId].map(Number).sort((a, b) => a - b);
      const minCode = codes.length > 0 ? codes[0] : '-'; // å–å‡ºæœ€å°æ•¸å­—

      html += `
        <div class="cust-card">
          <div class="min-code-side">${minCode}</div>
          
          <div class="cust-info-side">
            <div class="cust-name">${custId}</div>
            <div class="code-container">
              ${codes.map(c => `<div class="code-box">${c}</div>`).join('')}
            </div>
          </div>
        </div>
      `;
    });

    html += `</div>`;
    container.innerHTML += html;
  });
}

loadData();
</script>
</body>
</html>
