<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“¦ åŸ·è²¨æ¸…å–®</title>
<style>
  :root { --primary: #2563eb; --hk-color: #1e40af; --tw-color: #7c3aed; }
  body { font-family: -apple-system, sans-serif; background: #f8fafc; margin: 0; padding: 0; }
  
  /* å°è¦½åˆ— */
  .admin-nav { display: flex; justify-content: space-around; background: #fff; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
  .nav-btn { background: none; border: none; font-size: 12px; cursor: pointer; color: #64748b; display: flex; flex-direction: column; align-items: center; gap: 4px; }
  .nav-btn span { font-size: 18px; }
  .nav-btn.active { color: var(--primary); font-weight: bold; }

  /* ç™»å…¥å€ */
  #loginPanel { padding: 50px 20px; text-align: center; }
  .login-input { padding: 12px; width: 200px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px; }
  .login-btn { padding: 12px 30px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-weight: bold; }

  /* ä¸»é¢æ¿ */
  #mainPanel { padding: 15px; display: none; }
  
  /* åœ˜è™Ÿåˆ†é  (Tabs) */
  #groupTabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; white-space: nowrap; }
  .tab-btn { padding: 8px 16px; background: #e2e8f0; border: none; border-radius: 20px; font-size: 14px; cursor: pointer; }
  .tab-btn.active { background: var(--primary); color: #fff; }

  /* å¤§ç´…æ¡† */
  .region-section { background: #fff; border-radius: 15px; padding: 15px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 5px solid; }
  .hk-section { border-top-color: var(--hk-color); }
  .tw-section { border-top-color: var(--tw-color); }
  .region-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
  .total-weight { font-size: 13px; background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 20px; }

  .cust-card { display: flex; border: 2.5px solid #ef4444; border-radius: 12px; margin-bottom: 20px; background: #fff; overflow: hidden; }
  .min-code-side { background: #ef4444; color: #fff; font-size: 32px; font-weight: 900; width: 60px; display: flex; align-items: center; justify-content: center; align-self: stretch; }
  .cust-info-side { flex: 1; padding: 12px; display: flex; flex-direction: column; align-items: center; text-align: center; }
  .cust-name { font-weight: bold; font-size: 18px; color: #1e293b; margin-bottom: 12px; }
  
  /* å•†å“é¡¯ç¤ºå®¹å™¨ */
  .code-container { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
  .item-box { display: flex; flex-direction: column; align-items: center; gap: 4px; border: 1.5px solid #f59e0b; background: #fffbeb; padding: 5px; border-radius: 8px; }
  .code-num { font-weight: bold; font-size: 16px; color: #92400e; }
  .thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; background: #eee; }

  .loading { text-align: center; padding: 50px; color: #64748b; }
</style>
</head>
<body>

<div class="admin-nav" id="adminNav" style="display:none">
  <button class="nav-btn" onclick="location.href='index.html'"><span>ğŸ”</span>æŸ¥è©¢ ID</button>
  <button class="nav-btn" onclick="location.href='admin.html'"><span>âš–ï¸</span>åˆ°è²¨ç£…é‡</button>
  <button class="nav-btn active" onclick="location.href='pick-list.html'"><span>ğŸ“¦</span>åŸ·è²¨</button>
  <button class="nav-btn" onclick="alert('é–‹ç™¼ä¸­')"><span>ğŸ“¢</span>é€šçŸ¥å®¢äºº</button>
</div>

<div id="loginPanel">
  <h2>ğŸ“¦ åŸ·è²¨ç³»çµ±ç™»å…¥</h2>
  <input type="password" id="pw" class="login-input" placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼">
  <br>
  <button class="login-btn" onclick="doLogin()">ç™»å…¥</button>
</div>

<div id="mainPanel">
  <div id="groupTabs"></div>
  <div id="mainContent"></div>
</div>

<script>
const API = 'ä½ çš„_GAS_éƒ¨ç½²ç¶²å€';
let GLOBAL_DATA = null;
let CURRENT_GROUP = "";

function doLogin() {
  const pw = document.getElementById('pw').value;
  if (pw === '4916') {
    document.getElementById('loginPanel').style.display = 'none';
    document.getElementById('mainPanel').style.display = 'block';
    document.getElementById('adminNav').style.display = 'flex';
    loadData();
  } else {
    alert('å¯†ç¢¼éŒ¯èª¤');
  }
}

function loadData() {
  const content = document.getElementById('mainContent');
  content.innerHTML = '<div class="loading">æ­£åœ¨å„ªåŒ–è®€å–å¤§æ•¸æ“šä¸­...è«‹ç¨å€™...</div>';
  
  fetch(API, {
    method: 'POST',
    body: new URLSearchParams({ action: 'getPickListData', password: '4916' })
  })
  .then(r => r.json())
  .then(data => {
    GLOBAL_DATA = data.allGroups;
    CURRENT_GROUP = data.latestGroup;
    renderTabs();
    renderGroup(CURRENT_GROUP);
  });
}

function renderTabs() {
  const tabs = document.getElementById('groupTabs');
  const groupNames = Object.keys(GLOBAL_DATA).reverse(); // æœ€æ–°åœ˜åœ¨å‰
  tabs.innerHTML = groupNames.map(name => 
    `<button class="tab-btn ${name === CURRENT_GROUP ? 'active' : ''}" onclick="switchGroup('${name}')">${name}</button>`
  ).join('');
}

function switchGroup(name) {
  CURRENT_GROUP = name;
  renderTabs();
  renderGroup(name);
}

function renderGroup(groupName) {
  const container = document.getElementById('mainContent');
  const groups = GLOBAL_DATA[groupName];
  if (!groups) {
    container.innerHTML = `<div class="loading">æ­¤åœ˜ç„¡è³‡æ–™</div>`;
    return;
  }

  container.innerHTML = '';
  ['HK', 'TW'].forEach(regionKey => {
    const info = groups[regionKey];
    if (Object.keys(info.customers).length === 0) return;

    const label = regionKey === 'HK' ? 'ğŸ‡­ğŸ‡° é¦™æ¸¯åœ˜' : 'ğŸ‡¹ğŸ‡¼ å°ç£åœ˜';
    const cssClass = regionKey === 'HK' ? 'hk-section' : 'tw-section';

    let html = `<div class="region-section ${cssClass}"><div class="region-title">${label} <span class="total-weight">ç¸½é‡: ${info.totalWeight.toFixed(3)} kg</span></div>`;

    const sortedCustIds = Object.keys(info.customers).sort();
    sortedCustIds.forEach(custId => {
      // æ’åºå•†å“ä¸¦å–æœ€å°è™Ÿ
      const items = info.customers[custId].sort((a, b) => Number(a.code) - Number(b.code));
      const minCode = items.length > 0 ? items[0].code : '-';

      html += `
        <div class="cust-card">
          <div class="min-code-side">${minCode}</div>
          <div class="cust-info-side">
            <div class="cust-name">${custId}</div>
            <div class="code-container">
              ${items.map(item => `
                <div class="item-box">
                  ${item.img ? `<img src="${item.img}" class="thumb" loading="lazy">` : `<div class="thumb" style="display:flex;align-items:center;justify-content:center;font-size:10px;color:#ccc">ç„¡åœ–</div>`}
                  <div class="code-num">#${item.code}</div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    });
    html += `</div>`;
    container.innerHTML += html;
  });
}
</script>
</body>
</html>
